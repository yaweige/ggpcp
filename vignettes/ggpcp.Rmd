---
title: "Introduction to ggpcp"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{ggpcp}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This document shows how to make use of `ggpcp` functionalities with ggplot2 to draw an ideal parallel coordinate plot with numeric variables, categorical vairables or both. It provides a set of tools to deal with various cases and provides a good solution to draw factor variables.

```{r setup, message = FALSE}
library(ggplot2)
library(dplyr)
library(ggpcp)
```

## Start from the new interface

`ggpcp` is based on `ggplot2` frame work, so we have to provide a set of aesthetics when we draw a parallal coordinate plot, which also varies depending on which and how many variables you want to show on the plot. We simplified this work for you and provided a new interface that works well with tidy evaluation, which is a method used by `dplyr`. You can select the variables you want by:

* position: `1:4`, `c(1, 3, 7)`
* name: `mpg`, `cyl`, `mpg:cyl`, `sex`, `age`
* selector: `start_with("male")`, see `?tidyselect::select_helpers`

An example:

```{r, eval=FALSE}
data(mtcars)

mtcars %>%
  ggplot(aes(vars = vars(mpg:hp))) + 
  geom_pcp()

mtcars %>%
  ggplot(aes(vars = vars(mpg, cyl, disp, hp))) + 
  geom_pcp()

mtcars %>%
  ggplot(aes(vars = vars(1:4))) + 
  geom_pcp()
```

Notice that we used the new interface: an new aesthetics which is called `vars` and accepts the selection expression wrapped by function `vars()`. And the above three calls are exactly the same.

## The basic plot with geom_pcp()

The basic function or the main function of `ggpcp` is `geom_pcp()`, which will draw lines for parallel coordinate plot and deal with factor variables automatically by spreading them evenly on y-axis, in which case you can easily track the observations in these plot. And it is very powerful when there are a sequence of factor variables.

```{r}
mtcars %>% 
  head()
```

```{r}
mtcars %>% 
  ggplot(aes(vars = vars(1:4))) + 
  geom_pcp()
```

We can see from the plot above, the second variable is actually a categorical one. So we can treat it as a factor variable to get a better plot. Add some color according to that too.

```{r}
mtcars %>% 
  mutate(cyl = factor(cyl)) %>% 
  ggplot(aes(vars = vars(1:4))) + 
  geom_pcp(aes(color = cyl))
```

This is an extremely powerful functionality when it is used to deal with a sequence of factor variables.

```{r}
mtcars %>% 
  mutate(vs = factor(vs),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>% 
  ggplot(aes(vars = vars(vs:carb))) + 
  geom_pcp(aes(color = vs))
```

## Decorate the plot with geom_pcp_box(), geom_pcp_text()

To show the levels of factor variables better, you can use geom_pcp_box(), which is used to draw boxes for the levels. We can see from the following example.

```{r}
mtcars %>% 
  mutate(vs = factor(vs),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>% 
  ggplot(aes(vars = vars(vs:carb))) + 
  geom_pcp(aes(color = vs)) +
  geom_pcp_box()
```

If you want to see the boxes not black segments, you need to provide another argument: boxwidth to, unfortunately, both layer functions.

```{r}
mtcars %>% 
  mutate(vs = factor(vs),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>% 
  ggplot(aes(vars = vars(vs:carb))) + 
  geom_pcp(aes(color = vs), boxwidth = 0.2) +
  geom_pcp_box(boxwidth = 0.2)
```

Add labels on top of boxes with geom_pcp_text() or geom_pcp_label().

```{r}
mtcars %>% 
  mutate(vs = factor(vs),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>% 
  ggplot(aes(vars = vars(vs:carb))) + 
  geom_pcp(aes(color = vs), boxwidth = 0.2) +
  geom_pcp_box(boxwidth = 0.2) + 
  geom_pcp_text(boxwidth = 0.2)
```

## Draw bands with geom_pcp_band()

You can also draw bands with geom_pcp_band(). This can adds a layer to lines or boxes to compose a more meaningful plot. 

```{r, eval=FALSE}
mtcars %>% 
  mutate(cyl = factor(cyl),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>%
  gather_pcp(vs:carb) %>%
  ggplot(aes(id = id, name = name, value = value, level = level, class = class)) + 
  geom_pcp(aes(color = vs), boxwidth = 0.2) +
  geom_pcp_box(boxwidth = 0.2) +
  geom_pcp_band(aes(fill = vs), boxwidth = 0.2, alpha = 0.2)
```

Sometimes smaller bands are merged to a larger band, which is meaningful in showing a tidy plot, but will make it more difficult to color the bands. So we provide an argument to control this behavior. When you turn on the `merge`, the color/fill aesthetics is not reliable because `geom_pcp_band` will use the first observation in the merged band to color the whole band.

```{r, eval=FALSE}
mtcars %>% 
  mutate(cyl = factor(cyl),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>%
  gather_pcp(vs:carb) %>%
  ggplot(aes(id = id, name = name, value = value, level = level, class = class)) + 
  geom_pcp(aes(color = vs), boxwidth = 0.2) +
  geom_pcp_box(boxwidth = 0.2) +
  geom_pcp_band(boxwidth = 0.2, fill = "blue", alpha = 0.2, merge = TRUE)
```

## Methods with data transformation

## Adjust boxwidth, rugwidth and interwidth

ggpcp also provides a way to modify the parallel coordinate plot according to your need:

* boxwidth: adjust the width of boxes (for factor variable)
* rugwidth: adjust the width of rugs (for numeric variable)
* interwidth: adjust the distance between every two adjacent variables

These arguments accept a scalar or a vector with equal length of the object they control.

```{r, eval=FALSE}
mtcars %>% 
  mutate(cyl = factor(cyl),
         am = factor(am),
         gear = factor(gear),
         carb = factor(carb)) %>%
  gather_pcp(mpg, vs:carb) %>%
  transform_pcp(method = "uniminmax") %>%
  ggplot(aes(id = id, name = name, value = value, level = level, class = class)) + 
  geom_pcp(aes(color = vs), boxwidth = 0.2, rugwidth = 0.2,  interwidth = c(1, 1, 1.5, 2)) + 
  geom_pcp_box(boxwidth = 0.2, rugwidth = 0.2, interwidth = c(1, 1, 1.5, 2))
```

## Break the factor block

Our default method works great for a sequence of factor variables, but as the number variables increases, it becomes messier at the right side of the factor block, because the number of combinations of levels of variables increases. This is a conceptual problem which makes it hard to show the pattern of the data in these cases.

```{r, eval=FALSE}
mtcars %>% 
  mutate(cyl = factor(cyl),
         am = factor(am),
         gear = factor(gear)) %>%
  gather_pcp(vs:gear) %>%
  ggplot(aes(id = id, name = name, value = value, level = level, class = class)) + 
  geom_pcp(aes(color = vs), boxwidth = 0.5) + 
  geom_pcp_box(boxwidth = 0.5)
```

We provide a argument to partly sovle this problem. By making use of `breakpoint` in geom_pcp(), we can actually break a factor block to two or more smaller parts, which will better show the relations between the adjacent variables while keep tracking of individual observations.

```{r, eval=FALSE}
mtcars %>% 
  mutate(cyl = factor(cyl),
         am = factor(am),
         gear = factor(gear)) %>%
  gather_pcp(vs:gear) %>%
  ggplot(aes(id = id, name = name, value = value, level = level, class = class)) + 
  geom_pcp(aes(color = vs), boxwidth = 0.5, breakpoint = 2) + 
  geom_pcp_box(boxwidth = 0.5)
```

## Methods with overdrawing
